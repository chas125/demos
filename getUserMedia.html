<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no" />
<title>获取设备摄像头 getUserMedia</title>
<!--[if lt IE 9]><script>alert('您的浏览器版本过低，请更新本版本浏览器，或更换为诸如谷歌浏览器的现代浏览器')</script><![endif]-->
<style>
.bg {
    position: absolute;
    top: 0; bottom: 0;
    left: 0; right: 0;
    display: block;
    width: 100%; height: 100%;
    background: #000;
}
.tips {
    width: 100px; height: 100px;
    top: 50%; left: 50%;
    margin: -50px 0 0 -50px;
    position: absolute;
    z-index: 1;
    background: #fff;
}
</style>
</head>

<body>
<video class="bg"></video>
<div class="tips"></div>
<script src="//cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
<script>
navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);
window.URL = (window.URL || window.webkitURL || window.mozURL || window.msURL);

console.log(navigator.mediaDevices);

// 获取能拿到的设备数组
if (!MediaStreamTrack) {alert('不支持 MediaStreamTrack');}
if (!MediaStreamTrack.getSources) {alert('不支持 getSources 方法');}
var exArray = [];
MediaStreamTrack.getSources(function(sourceInfos) {
    for (var i = 0; i != sourceInfos.length; ++i) {
        var sourceInfo = sourceInfos[i]; //这里会遍历audio,video，所以要加以区分 
        if (sourceInfo.kind === 'video') { exArray.push(sourceInfo.id); }
    }
    if (!navigator.getUserMedia) {alert('不支持 getUserMedia 方法')}

    navigator.getUserMedia({
        "video": {
            "optional": [{
                "sourceId": exArray[1]
            }]
        },
        "audio": false
    }, successFunc, errorFunc)
});

// var mediaOpts = {
//     audio: false,
//     // video: true,
//     // video: { width: 1280, height: 720 }
//     video: {
//         // mandatory: {
//         //     minAspectRatio: 1.40,
//         //     maxAspectRatio: 1.78,
//         //     minFrameRate: 15,
//         //     maxFrameRate: 25,
//         //     minWidth: 320,
//         //     minHeight: 480,
//         // },
//         optional: [{
//             sourceId: exArray[1]
//         }]
//     }
// }
// navigator.getUserMedia(mediaOpts, successFunc, errorFunc);



function successFunc(stream) {
    // alert('ok');
    var video = document.querySelector('video');
    if (video.mozSrcObject !== undefined) {
        video.mozSrcObject = stream
    } else {
        video.src = window.URL && window.URL.createObjectURL(stream) || stream
    }
    video.play();
    $('.tips').on('click', function(){
        alert('xx');
    });
}
function errorFunc(err) {
    alert(err.name);
}
</script>
</body>
</html>